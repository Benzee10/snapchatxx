<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Find Your Local Baddie</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>Find Your Local Baddie</h1>

    <div class="controls">
      <select id="country">
        <option value="">All Countries</option>
        <option value="Nigeria">Nigeria</option>
        <option value="South Africa">South Africa</option>
        <option value="Ghana">Ghana</option>
      </select>
      <input type="text" id="search" placeholder="Search by name..." />
    </div>

    <div id="sub-info" style="text-align:center; margin-bottom:10px;"></div>
    <div id="loader">Loading profiles...</div>
    <div id="profile-gallery" class="gallery"></div>
  </div>

  <script type="module">
    import { supabase } from './supabase-config.js';

    let models = [];

    async function loadModels() {
      document.getElementById("loader").style.display = "block";
      const { data, error } = await supabase.from('models').select('*');
      document.getElementById("loader").style.display = "none";
      if (error) {
        alert("Error loading models.");
        console.error(error);
        return;
      }
      models = data;
      filterModels();
    }

    function displayModels(data) {
      const gallery = document.getElementById("profile-gallery");
      gallery.innerHTML = "";
      if (data.length === 0) {
        gallery.innerHTML = "<p>No profiles found.</p>";
        return;
      }
      data.forEach((model) => {
        const card = document.createElement("div");
        card.className = "profile-card";
        card.innerHTML = `
          <img src="${model.image_url}" alt="${model.name}" />
          <div class="card-info">
            <h2>${model.name}</h2>
            <p class="bio">${model.bio}</p>
            <p class="country">${model.country}</p>
            <button onclick="unlock('${model.whatsapp}')">Chat on WhatsApp</button>
          </div>`;
        gallery.appendChild(card);
      });
    }

    function unlock(number) {
      const subscribed = localStorage.getItem("subscribed") === "true";
      if (subscribed) {
        window.open(`https://wa.me/${number.replace("+", "")}`, "_blank");
      } else {
        alert("This feature is locked. Please subscribe to unlock.");
      }
    }

    function filterModels() {
      const country = document.getElementById("country").value.toLowerCase();
      const search = document.getElementById("search").value.toLowerCase();

      const filtered = models.filter((m) => {
        const nameMatch = m.name.toLowerCase().includes(search);
        const countryMatch = country === "" || m.country.toLowerCase() === country;
        return nameMatch && countryMatch;
      });

      displayModels(filtered);
    }

    document.getElementById("country").addEventListener("change", filterModels);
    document.getElementById("search").addEventListener("input", filterModels);

    // Subscription check logic
    function checkSubscription() {
      const expiry = localStorage.getItem("sub_expiry");
      const infoBox = document.getElementById("sub-info");
      if (expiry && Date.now() < parseInt(expiry)) {
        localStorage.setItem("subscribed", "true");
        const timeLeft = parseInt(expiry) - Date.now();
        const mins = Math.floor(timeLeft / 60000);
        infoBox.innerHTML = `âœ… Subscription active. Expires in ${mins} mins.`;
      } else {
        localStorage.setItem("subscribed", "false");
        infoBox.innerHTML = `ðŸ”’ Profiles locked. <button onclick="fakeSubscribe()">Fake Subscribe</button>`;
      }
    }

    // Temporary mock subscription (you'll replace with real payment logic)
    function fakeSubscribe() {
      const durationMins = 60;
      const expiry = Date.now() + durationMins * 60 * 1000;
      localStorage.setItem("sub_expiry", expiry);
      localStorage.setItem("subscribed", "true");
      checkSubscription();
    }

    window.fakeSubscribe = fakeSubscribe;
    window.unlock = unlock;
    window.onload = () => {
      checkSubscription();
      loadModels();
    };
  </script>
</body>
</html>
